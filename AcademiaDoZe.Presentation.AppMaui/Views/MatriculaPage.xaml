<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
            xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
            x:Class="AcademiaDoZe.Presentation.AppMaui.Views.MatriculaPage"
            xmlns:vm="clr-namespace:AcademiaDoZe.Presentation.AppMaui.ViewModels"
            xmlns:enums="clr-namespace:AcademiaDoZe.Application.Enums;assembly=AcademiaDoZe.Application"
            xmlns:converters="clr-namespace:AcademiaDoZe.Presentation.AppMaui.Converters"
            xmlns:dto="clr-namespace:AcademiaDoZe.Application.DTOs;assembly=AcademiaDoZe.Application"
            x:DataType="vm:MatriculaViewModel">
    <ContentPage.Resources>
        <converters:FotoToImageSourceConverter x:Key="FotoToImageSourceConverter" />
        <converters:DateOnlyToDateTimeConverter x:Key="DateOnlyConverter" />
        <converters:EnumDisplayConverter x:Key="EnumDisplay" />
    </ContentPage.Resources>
    <ScrollView>
        <StackLayout Spacing="20">
            <!-- CPF Section -->

            <Border Style="{StaticResource CardBorder}" Margin="15,10">

                <StackLayout Spacing="5">
                    <Label Text="CPF"/>
                    <Grid ColumnDefinitions="*,Auto">
                        <Entry Grid.Column="0" Text="{Binding Matricula.AlunoMatricula.Cpf}" Placeholder="000.000.000-00" Keyboard="Numeric" Margin="0,0,10,0"/>
                        <Button Grid.Column="1" Text="" Command="{Binding SearchByCpfCommand}" Style="{StaticResource ButtonPrimary}" HeightRequest="40" Padding="15,0">
                            <Button.ImageSource>
                                <FontImageSource FontFamily="MaterialIcons" Glyph="&#xe8b6;" />
                            </Button.ImageSource>
                        </Button>
                    </Grid>
                </StackLayout>
            </Border>
            <!-- Dados Pessoais -->

            <Border Style="{StaticResource CardBorder}" Margin="15,10">

                <StackLayout Spacing="15">
                    <Label Text="{Binding Path=[strDadosPessoais], Source={StaticResource LocalizedStrings}}" Style="{StaticResource SubHeadline}"/>
                    <StackLayout Orientation="Horizontal">
                        <StackLayout Orientation="Vertical">
                            <StackLayout Orientation="Horizontal" Margin="0,0,0,5">
                                <Label Text="Aluno Selecionado:"/>
                                <Label Text="{Binding Matricula.AlunoMatricula.Nome}" Margin="5,0,0,0" />
                            </StackLayout>
                            <StackLayout Orientation="Horizontal" Margin="0,0,0,5">
                                <Label Text="Cpf:"/>
                                <Label Text="{Binding Matricula.AlunoMatricula.Cpf}" Margin="5,0,0,0" />
                            </StackLayout>
                            <StackLayout Orientation="Horizontal" Margin="0,0,0,5">
                                <Label Text="Data Nascimento:"/>
                                <Label Text="{Binding Matricula.AlunoMatricula.DataNascimento}" Margin="5,0,0,0" />
                            </StackLayout>
                        </StackLayout>
                        <StackLayout>
                            <Image Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2" Grid.RowSpan="11" Source="{Binding Matricula.AlunoMatricula.Foto, Converter={StaticResource FotoToImageSourceConverter}}" Aspect="AspectFill" Margin="50,0,10,0" >
                                <Image.HeightRequest>
                                    <OnIdiom x:TypeArguments="x:Double">
                                        <OnIdiom.Phone>110</OnIdiom.Phone>
                                        <OnIdiom.Tablet>120</OnIdiom.Tablet>
                                        <OnIdiom.Desktop>120</OnIdiom.Desktop>
                                        <OnIdiom.TV>140</OnIdiom.TV>
                                        <OnIdiom.Default>110</OnIdiom.Default>
                                    </OnIdiom>
                                </Image.HeightRequest>

                                <Image.WidthRequest>

                                    <OnIdiom x:TypeArguments="x:Double">
                                        <OnIdiom.Phone>110</OnIdiom.Phone>
                                        <OnIdiom.Tablet>120</OnIdiom.Tablet>
                                        <OnIdiom.Desktop>120</OnIdiom.Desktop>
                                        <OnIdiom.TV>140</OnIdiom.TV>
                                        <OnIdiom.Default>110</OnIdiom.Default>
                                    </OnIdiom>
                                </Image.WidthRequest>
                            </Image>
                        </StackLayout>
                    </StackLayout>

                    <StackLayout>
                        <Picker ItemsSource="{Binding MatriculaPlanos}" SelectedItem="{Binding Matricula.Plano}">
                            <Picker.ItemDisplayBinding>
                                <Binding Converter="{StaticResource EnumDisplay}" />
                            </Picker.ItemDisplayBinding>
                        </Picker>
                    </StackLayout>
                    <StackLayout Spacing="20" Orientation="Horizontal">
                        <Label Text="Data Inicio"/>
                        <DatePicker Date="{Binding Matricula.DataInicio, Converter={StaticResource DateOnlyConverter}, Mode=TwoWay}"/>
                    </StackLayout>
                    <StackLayout Spacing="5">
                        <Label Text="Objetivo"/>
                        <Entry Text="{Binding Matricula.Objetivo}" Placeholder="Digite seu objetivo" />
                    </StackLayout>
                    <VerticalStackLayout Padding="20">
                        <Label Text="{Binding Path=[strSelecioneRestricoes], Source={StaticResource LocalizedStrings}}" 
                                Style="{StaticResource SubHeadline}" />

                        <!--Lista de CheckBoxes-->
                        <CollectionView ItemsSource="{Binding OpcoesTipo}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="vm:TipoMatriculaOption">
                                    <Grid ColumnDefinitions="*, Auto" Padding="10,5">
                                        <Label Grid.Column="0" 
                                            Text="{Binding Nome}" 
                                            VerticalOptions="Center" />

                                        <CheckBox Grid.Column="1" 
                                        IsChecked="{Binding IsSelecionado, Mode=TwoWay}"
                                        VerticalOptions="Center"/>
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                    <StackLayout Spacing="5">
                        <Label Text="Observações restrições"/>
                        <Entry Text="{Binding Matricula.ObservacoesRestricoes}" Placeholder="Digite as observações das restrições" />
                    </StackLayout>
                    <StackLayout Spacing="5">
                        <Label Text="Foto"/>
                        <Image Source="{Binding Matricula.LaudoMedico, Converter={StaticResource FotoToImageSourceConverter}}" Aspect="AspectFill" HeightRequest="120" WidthRequest="120"/>
                        <Button Text="{Binding Path=[strSelecionarImagem], Source={StaticResource LocalizedStrings}}" Command="{Binding SelecionarFotoCommand}" Style="{StaticResource ButtonPrimary}" >
                            <Button.ImageSource>
                                <FontImageSource FontFamily="MaterialIcons" Glyph="&#xe226;" />
                            </Button.ImageSource>
                        </Button>
                    </StackLayout>
                </StackLayout>
            </Border>

            <Grid ColumnDefinitions="*,*" ColumnSpacing="10" Margin="15,10">

                <Button Grid.Column="0" Text="{Binding Path=[strCancelar], Source={StaticResource LocalizedStrings}}" Command="{Binding CancelCommand}" Style="{StaticResource ButtonSecondary}" HeightRequest="50">
                    <Button.ImageSource>
                        <FontImageSource FontFamily="MaterialIcons" Glyph="&#xe5c9;" />
                    </Button.ImageSource>
                </Button>

                <Button Grid.Column="1" Text="{Binding Path=[strSalvar], Source={StaticResource LocalizedStrings}}" Command="{Binding SaveMatriculaCommand}" Style="{StaticResource ButtonPrimary}" HeightRequest="50">

                    <Button.ImageSource>
                        <FontImageSource FontFamily="MaterialIcons" Glyph="&#xe148;" />
                    </Button.ImageSource>

                </Button>
            </Grid>
            <!-- Loading Indicator -->
            <ActivityIndicator IsVisible="{Binding IsBusy}" IsRunning="{Binding IsBusy}" VerticalOptions="Center" HorizontalOptions="Center"/>

        </StackLayout>
    </ScrollView>
</ContentPage>